define("common:widget/ui/searchInViewControl/SearchInViewControl.js",function(t,e,i){function o(){var e='#siv_main{width:253px;font-family:"宋体",arial;margin-top:0}.siv_list{margin-top:10px;overflow:hidden}.siv_list li{float:left;clear:both;overflow:hidden;line-height:18px;padding:2px 0 8px 25px;zoom:1}.siv_list li span{float:left;margin:3px 0 0 -25px;*margin:1px 0 0 -25px;width:25px;height:14px;background:url(http://webmap1.map.bdstatic.com/wolfman/static/common/images/new-icon_4aab9e1.png) no-repeat 0 -45px}.siv_list .canyin span{background-position:-21px -51px;width:14px}.siv_list .dianying span{background-position:-63px -51px;width:14px}.siv_list .jiayou span{background-position:-42px -51px;width:15px}.siv_list .jiudian span{width:14px;left:2px;background-position:0 -51px}.siv_list li a{float:left;margin-right:12px;cursor:pointer;white-space:nowrap}.siv_note{color:gray;padding-top:8px;line-height:16px}.siv_sec{margin-top:3px;overflow:hidden}.siv_lst{line-height:18px}.siv_lst a{margin-right:5px;cursor:pointer}.siv_title{margin-bottom:1px}.siv_txt,.siv_btn{float:left}.siv_txt{width:177px;height:19px;color:gray;line-height:19px;padding-left:4px;border:#c3c3c2 1px solid}.siv_txt_hover{color:#000}.siv_btn{width:48px;height:26px;border:0;background:url(http://webmap1.map.bdstatic.com/wolfman/static/common/images/sehInView_dce8b8b.png) no-repeat 0 0;cursor:pointer;margin-left:5px;padding:0}.siv_btn_over{background-position:-50px 0}.siv_btn_down{background-position:-100px 0;font-weight:700}.siv_lnote{font-size:14px;padding:10px 0 5px}.siv_resultext{font-size:12px;padding:10px 0 0}.siv_resultext span{font-size:12px}.siv_resultext a{position:absolute;right:3px}.siv_resultext.nr{color:#e60000}';t.loadCss({content:e,name:"SearchInViewControl"})}var n=t("common:widget/com/componentManager.js"),s=(t("common:widget/ui/mapInfo/mapInfo.js"),t("common:widget/ui/config/config.js")),a=t("common:widget/ui/Traffic/Traffic.js"),r=t("common:widget/ui/util/util.js"),p=s.modelConfig,c=(s.mapConfig,t("common:widget/ui/genericRequest/GenericRequest.js"));window.GRControll||(window.GRControll=new c({toolAreaId:"GR_Select"})),o();var l=function(){var t=this;t.initialize()};l.prototype.initialize=function(t){try{this._map=t,this.isOpen=!1,this.hasResult=!1,this.curKw="",this.listeners=[],this.resultCount=10,this.reqObj=null,this.rightPos=13,this.heightType=-1,this.curSearchCPt=null,this._container=T.g("search_in_view")}catch(e){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"common:widget/ui/searchInViewControl/SearchInViewControl.js",ln:71})}},l.prototype.setStatus=function(){var t=this;t.isMoving||(0==t.heightType?(t.sivPop.setHeight(215),t.deletePop(),t.heightType=-1):1==t.heightType&&(t.sivPop.setHeight(65),t.deletePop(),t.heightType=-1))},l.prototype.resetClassName=function(){this._container._opened=!1,T.rc(this._container,"span_focus")},l.prototype.deletePop=function(){this.sivPop&&(this.sivPop.main.parentNode.removeChild(this.sivPop.main),this.sivPop=null,this.exit(!0))},l.prototype.remove=function(){var t=document.getElementById("searchInView"+this.guid);t&&t.parentNode&&(t.onclick=null,t.parentNode.removeChild(t))},l.prototype._getRightPos=function(){if(T.G("MapInfo")&&!isNaN(parseInt(T.G("MapInfo").style.width))){var t=this.rightPos+parseInt(T.G("MapInfo").style.width);return t>0?t:0}return this.rightPos+280},l.prototype.setResult=function(t){this.hasResult=!!t.hasResult,this.curKw=t.kw,this.curSearchCPt=t.cpt},l.prototype.checkNeed2Go=function(){var t=this._map;if(!this.curKw)return!1;if(!this.curSearchCPt)return!1;var e=t.pointToPixel(this.curSearchCPt),i=t.pointToPixel(t.getCenter()),o=Math.abs(e.x-i.x),n=Math.abs(e.y-i.y);return o>=.3*t.width||n>=.3*t.height?!0:!1},l.prototype.rego=function(){var t=this._map,e=t.getBounds(),i="("+e.minX+","+e.minY+";"+e.maxX+","+e.maxY+")";if(this.curKw){var o=window.location.pathname+p.DATA_URL+"bd&c="+p.cityCode+"&format=1&ie=utf-8&pn=0&rn="+this.resultCount+"&wd="+encodeURIComponent(this.curKw)+"&ar="+i+"&b="+i+"&l="+t.getZoom()+"&t="+(new Date).getTime();baidu.ajax(o,{dataType:"json",success:function(t){!t||!t.content},error:function(t,e){console.log(o,e)}})}},l.prototype.clear=function(){},l.prototype.exit=function(t){if(0!=this.isOpen){this.isOpen=!1;var e=this._map,i=this;if(t?i.sivPop&&(i.sivPop.close(),i.sivPop=null):i.deletePop(),i.hasResult&&(e.closeInfoWindow(),window.GRControll.clearCache(),window.GRControll.clearGRMap(),i.hasResult=!1),i.listeners)for(var o=0,n=i.listeners.length;n>o;o++){var s=i.listeners[o];s.obj.removeEventListener&&s.obj.removeEventListener(s.type,s.cbk)}t||(i.curKw=""),i.curSearchCPt=null,i.resetClassName(),listener.trigger("index.controls","close",{target:"search-in-view"})}},l.prototype.getResultCount=function(){return this.resultCount},l.prototype.isInUse=function(){return!!this.curKw},l.prototype.getPreModelName=function(){return this.preModel&&this.preModel._className},l.prototype.getPreModel=function(){return this.preModel},l.prototype.prepare=function(){var t=(this._map,this),e=window.currentComponent._className,i=window.currentComponent;"SearchInView"==e&&i&&""!=i.json.result.wd&&""==this.curKw&&(this.curKw=i.json.result.wd),t.hasClickButton||(t.curKw=""),a.exit(),t.sivPop?t.setPopStatus():t.showViewPop()},l.prototype.setPopStatus=function(){var t=this;window.trafficCtrl&&(trafficCtrl.close(),trafficCtrl.markers=null),window.currentComponent&&"NavTrans"===window.currentComponent._className?window.driveCtrl&&driveCtrl.menu(!1):window.driveCtrl&&driveCtrl.hide(!0),t.sivPop.show(),this.setPopupHeight(""==this.curKw?1:2),t.preModel=n.get(window.currentComponent._className),t.isOpen=!0,this._container._opened=!0,this._container.className.indexOf("span_focus")<0&&T.ac(this._container,"span_focus"),baidu("a.siv_result_change_link")&&(baidu("a.siv_result_change_link").off("click"),baidu("a.siv_result_change_link").on("click",function(e){addStat("indextool.searchinview.reopensearchinview","click",{da_e_name:"pcmap3"}),t.clearGo(),e.preventDefault()}))},l.prototype.showViewPop=function(){var e=this;t.async("common:widget/ui/Popup/Popup.js",function(t){e.sivPop=new t({title:"在屏幕范围内搜索",content:""==e.curKw?e.setSIVContent():e.getResultHTML(e.curKw),width:288,addDom:"ui3_control_wrap",closeButton:"<button id='sivCtrlCloseBtn' style='position:absolute;border:0;cursor:pointer;top:5px;right:4px;width:12px;height:12px; background:url(http://webmap1.map.bdstatic.com/wolfman/static/common/images/sehInView_dce8b8b.png) no-repeat -100px -40px;'></button>",clickClose:!1,closeEffect:function(){listener.trigger("index.controls","close",{target:"search-in-view"}),0==e.heightType?(e.sivPop.setHeight(215),e.slideEffect({s_mt:0,e_mt:-182,s_h:215,e_h:33},function(){e.deletePop()}),e.heightType=-1):1==e.heightType&&(e.sivPop.setHeight(65),e.slideEffect({s_mt:0,e_mt:-32,s_h:65,e_h:33},function(){e.deletePop()}),e.heightType=-1)}}),e.sivPop.render(),e.sivPop.getDom()._anchor=1,e.sivPop.getDom()._offset={x:8,y:34},e.sivPop.getDom().style.right="56px",e.sivPop.getDom().style.top="27px",e.sivPop.getDom().style.zIndex=1,e.sivPop.content.style.paddingLeft="10px",e.sivPop.getDom().onclick=function(t){t=t||window.event,r.stopBubble(t)},e.bindSearchEvents(),e.setPopStatus()})},l.prototype.bindSearchEvents=function(){var t=this;baidu("ul.siv_list").delegate("a","click",function(e){t.search(this),e.preventDefault()}),baidu("form.search_from").on("submit",function(e){t.search(),e.preventDefault()}),baidu("#siv_kw").on("focus",function(){t.kwFocus(this)}),baidu("#siv_kw").on("blur",function(){t.kwBlur(this)}),baidu("#sivSubmitBtn").on("mouseover",function(e){t.btnOver(e,this)}),baidu("#sivSubmitBtn").on("mouseout",function(e){t.btnOut(e,this)}),baidu("#sivSubmitBtn").on("mouseup",function(e){t.btnOver(e,this)}),baidu("#sivSubmitBtn").on("mousedown",function(e){t.btnDown(e,this)})},l.prototype.setSIVContent=function(){var t={jiudian:["快捷酒店","星级酒店","旅馆","如家","7天"],canyin:["餐馆","快餐","肯德基","麦当劳","咖啡厅"],jiayou:["楼盘小区","公交车站","银行","医院","超市","ATM","停车场","加油站"],dianying:["KTV","电影院","网吧","酒吧","健身中心"]},e='<div id="siv_main" class="blueC"><ul class="siv_list">';for(var i in t){var o=t[i];e+='<li class="'+i+'"><span></span>';for(var n=0;n<o.length;n++)e+='<a href="javascript:void(0)" >'+o[n]+"</a>";e+="</li>"}return e+="</ul>",e+='<div class="siv_sec">',e+='<form class="search_from" >',e+='<input id="siv_kw" value="查找其他关键词" class="siv_txt" type="text" autocomplete="off" />',e+='<input value="搜索" type="submit" class="siv_btn" id="sivSubmitBtn"  />',e+="</form></div>"},l.prototype.kwFocus=function(t){"查找其他关键词"==t.value&&(t.value="",T.ac(t,"siv_txt_hover"))},l.prototype.kwBlur=function(t){""==t.value&&(t.value="查找其他关键词",T.rc(t,"siv_txt_hover"))},l.prototype.search=function(t,e){var i="",o="0",s=t&&t.innerHTML,a=0;switch(s){case"快捷酒店":addStat("indextool.searchinview.expresshotel");break;case"星级酒店":addStat("indextool.searchinview.starratedhotel");break;case"旅馆":addStat("indextool.searchinview.hotel");break;case"餐馆":addStat("indextool.searchinview.restaurant");break;case"公交车站":addStat("indextool.searchinview.busstation");break;case"楼盘小区":addStat("indextool.searchinview.community");break;case"银行":addStat("indextool.searchinview.bank");break;case"如家":addStat("indextool.searchinview.homeinn");break;case"超市":addStat("indextool.searchinview.supermarket");break;case"7天":addStat("indextool.searchinview.7daysinn");break;case"医院":addStat("indextool.searchinview.hospital");break;case"电影院":addStat("indextool.searchinview.cinema");break;case"网吧":addStat("indextool.searchinview.netcafe");break;case"快餐":addStat("indextool.searchinview.fastfood");break;case"肯德基":addStat("indextool.searchinview.kfc");break;case"KTV":addStat("indextool.searchinview.ktv");break;case"ATM":addStat("indextool.searchinview.atm");break;case"停车场":addStat("indextool.searchinview.parkinglot");break;case"麦当劳":addStat("indextool.searchinview.macdonald");break;case"咖啡厅":addStat("indextool.searchinview.cafe");break;case"健身中心":addStat("indextool.searchinview.fittingcentre");break;case"酒吧":addStat("indextool.searchinview.bars");break;default:addStat("indextool.searchinview.userinput")}if(t?i=t.innerHTML:(i=r.filtQuery(e||T.G("siv_kw").value),a=1,o="1"),""==i||"查找其他关键词"==i)return void T.G("siv_kw").focus();{var c=map.getBounds();"("+c.minX+","+c.minY+";"+c.maxX+","+c.maxY+")"}this.setResult({hasResult:!1,kw:i,cpt:map.getCenter()});var l=map.getBounds(),h="&b=("+l.minX+","+l.minY+";"+l.maxX+","+l.maxY+")&l="+map.getZoom();window.GRControll.openedMarker=null;var u=this;this.setResultHTML(null,function(){n.go("bd&fstq=1&from=webmap&c="+p.cityCode+"&pn=0&rn="+u.resultCount+"&wd="+encodeURIComponent(i)+"&sivtp="+a+h+"&bdfrom="+o,{cinfo:{exitLargeMapMode:!1,searchInView:!0},dom:baidu("#MapInfo")})})},l.prototype.setResultHTML=function(t,e){if(this.sivPop.content){var i=this;this.setPopupHeight(0,function(){i.sivPop.content.innerHTML=i.getResultHTML(t),e&&e(),baidu(".siv_result_change_link").on("click",function(t){addStat("indextool.searchinview.reopensearchinview","click",{da_e_name:"pcmap3"}),i.clearGo(),t.preventDefault()})})}},l.prototype.getResultHTML=function(t){t||this.curKw;return"<div  id='siv_main' class='blueC'><p class='siv_resultext'>当前搜索： <span class='important'>"+T.string.subByte(this.curKw,12,"...")+"</span><a class='siv_result_change_link' href='javascript:void(0)' >更改条件</a></p></div>"},l.prototype.clearGo=function(){this.hasResult=!1;var t=this.curKw;this.setResult({hasResult:!1,kw:t,cpt:map.getCenter(),tp:0}),this.sivPop.content&&(this.sivPop.content.innerHTML=this.setSIVContent(),this.setPopupHeight(1),this.bindSearchEvents())},l.prototype.setPopupHeight=function(t,e){this._map;if(this.sivPop)switch(t){case 0:this.sivPop.setHeight(215),this.slideEffect({s_mt:0,e_mt:-150,s_h:215,e_h:65},e),this.heightType=1;break;case 1:this.sivPop.setHeight(33),this.slideEffect({s_mt:-182,e_mt:0,s_h:33,e_h:215}),this.heightType=0;break;case 2:this.sivPop.setHeight(33),this.slideEffect({s_mt:-32,e_mt:0,s_h:33,e_h:65}),this.heightType=1}},l.prototype.hidePopup=function(){this.sivPop&&this.sivPop.hide()},l.prototype.showPopup=function(){this.sivPop&&this.sivPop.show()},l.prototype.slideEffect=function(t,e){if(t.s_mt!=t.e_mt&&t.s_h!=t.e_h&&T.G("siv_main")){var i=T.G("siv_main"),o=this,n=0;n=t.s_mt<t.e_mt?15:-15,o.seTop=t.s_mt,o.seH=t.s_h,o.isMoving=!0,o.seTime=setInterval(function(){(t.s_mt<t.e_mt?o.seTop+n>=t.e_mt:o.seTop+n<=t.e_mt)?(i.style.marginTop=t.e_mt+"px",o.sivPop.setHeight(t.e_h),clearInterval(o.seTime),o.seTime=null,o.isMoving=!1,e&&"function"==typeof e&&e()):(o.seTop+=n,o.seH+=n,i.style.marginTop=o.seTop+"px",o.sivPop.setHeight(o.seH))},20)}},l.prototype.btnOver=function(t,e){t=t||window.event,r.stopBubble(t),e.className="siv_btn siv_btn_over"},l.prototype.btnOut=function(t,e){t=t||window.event,r.stopBubble(t),e.className="siv_btn"},l.prototype.btnDown=function(t,e){t=t||window.event,r.stopBubble(t);var i=1;T.browser.ie||(i=0),t&&t.button!=i||(e.className="siv_btn siv_btn_down")},l.prototype.show=function(){this._container.style.display="block"},l.prototype.hide=function(){this._container.style.display="none"},i.exports=l});