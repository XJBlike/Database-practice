define("pano:widget/module/PanoLoading/PanoLoading.js",function(e,n,i){function o(e,n){if(e=t(n,e),e&&e.panoid&&e.panotype){var i="http://webmap0.map.bdstatic.com/wolfman/static/pano/images/pano_whole/pano_loading_24c94ab.gif",o=document.body.clientWidth,a=document.body.clientHeight,d=document.createElement("div");d.id="pano_loading_mask";var p={position:"absolute",left:"0px",top:"0px",zIndex:99999999,width:o+"px",height:a+"px",background:"#fff"};for(var l in p)d.style[l]=p[l];d.innerHTML='<img src="'+i+'" width="84px" height="55px" style="position:absolute; top:50%; left:50%; margin-left:-42px; margin-top:-55px;" />',document.body.appendChild(d)}}function t(e,n){if(e.indexOf("#")>-1){var i=e.slice(e.indexOf("#")+1);if(""!=i)for(var o=i.split("&"),t=0;t<o.length;t++){var a=o[t].split("=");if(a[1]){var d=a[1].indexOf("#");a[1]=d>-1?a[1].slice(0,d):a[1],n[a[0]]=a[1]}}}return n}function a(){var e=document.getElementById("pano_loading_mask");e&&document.body.removeChild(e)}i.exports={createMask:o,removeMask:a}});
;define("pano:widget/PanoUtil/PanoUtil.js",function(o,e,t){var i=(window.Pano=window.Pano||{},{panoType:"",isOpen:!1,closePano:function(o,e){window.streetViewTool&&window.streetViewTool.isOpen&&!e&&window.streetViewTool.resetStatus(),o&&"tool"==o&&window.streetViewTool&&window.streetViewTool.setStatus()},hide:function(){this.closePano()},clearStatus:function(){window.streetViewTool&&window.streetViewTool.resetStatus()},isPanoStatus:function(){return window.streetViewTool&&window.streetViewTool.isOpen||this.isOpen?!0:!1},revert:function(){}});t.exports=i});
;define("pano:widget/base/CatalogMap.js",function(){var a=["其他","正门","房型","设施","正门","餐饮设施","其他设施","正门","设施","观影厅","其他设施"],n=[0,1,2,2,2,2,2,2,2,3,3,3,3,4,5,5,5,6,6,7,8,8,8,9];return{getCatalogInfo:function(e){var t=n[1*e]||0;return{id:t,label:a[t]}}}});
;define("pano:widget/base/util.js",function(e,n,t){var r=e("common:widget/ui/config/config.js"),o=e("common:widget/ui/mapUtil/mapUtil.js"),a=r.modelConfig,i=function(){},u=/<[^>]*>|<\/[^>]*>/gm,c={trim:function(){return String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(/(^\s*)|(\s*$)/g,"")}}(),converToArray:function(e){var n=c.each(e,function(e){return e},!0);return n},getUniqueId:function(){var e=1;return function(n,t){n?"number"==typeof n?(t=n,n="_$unique_id_"):"undefined"==typeof t&&(t=1):(t=1,n="_$unique_id_");var r=c.each(new Array(t||1),function(t,r){return n+(e+r)},!0);return e+=t||1,1===r.length?r[0]:r}}(),log:function(){return console?function(){console.log.apply(console,arguments)}:i}(),merge:function(){for(var e=c.converToArray(arguments),n={},t=0,r=e.length;r>t;t++){var o=e[t]||{};for(var a in o)o.hasOwnProperty(a)&&(n[a]=o[a])}return n},getRandom:function(){var e=0;return function(){return"_$rid"+e++}}(),each:function(e,n,t){var r,o,a=[],i=e.length;if(t){for(o=0;i>o&&(r=n.call(e,e[o],o,a),void 0!==r&&a.push(r),r!==!0);o++);return a}for(o=0;i>o&&n.call(e,e[o],o)!==!0;o++);return void 0},some:function(e,n){for(var t=0,r=e.length;r>t;t++)if(n(e[t],t)===!0)return!0;return!1},isIE:function(){return!1},setOpacity:function(e,n){e.style.opacity=n},showDetail:function(e,n,t,r,o,a,i,u){window.place.showDetail(e,n,t,r,o,a,i,u)},getSearchResultFromUrl:function(e){var n=new T.Deferred;return T.ajax(e,{dataType:"json",success:function(t){return t&&t.result?void n.resolve(t,e):void n.resolve(null)},error:function(){n.resolve(null)}}),n},getImage3DUrl:function(e,n,t,o,a,i,u){e=e||r.urlConfig.PANO_3DIMAGE_URL;var c="{baseURL}/?qt=pr3d&fovy={fovy}&quality=80&panoid={panoId}&heading={panoHeading}&pitch={panoPitch}&width={width}&height={height}",s={baseURL:e,panoId:n,panoHeading:t||0,panoPitch:o||0,width:a,height:i,fovy:u||35};return c.replace(/\{(.*?)\}/g,function(e,n){return s[n]})},getBusLineInfoFromPCMap:function(e,n){function t(e,n,t){var o=0,a=null,i=1/0,u="";return c.each(e,function(e){a=r(e.geo),o=Math.pow(a.x-n,2)+Math.pow(a.y-t,2),i>o&&(i=o,u=e.uid)}),u}function r(e){var n=e.split("|")[2].split(";")[0],t=n.split(",");return{x:t[0],y:t[1]}}var o=window.componentManager.get("PoiSearch"),a="",i="",u=window.componentManager.get("BusLines");return u&&u.json&&u.json.content&&u.json.content[0]&&(a=t(currentComponent.json.content[0].stations,e,n),i=u.json.content[0].uid),o&&o.searchController&&o.searchController.modules&&o.searchController.modules.length>0&&c.some(o.searchController.modules,function(r){return r.selectLine===!0&&1==r.active?(a=t(r.curStops,e,n),i=r.data.uid,!0):void 0}),i&&a?{buslineUid:i,closestBusStationUid:a}:null},getSearchResultFromPCMap:function(e){var n=window.componentManager.get("PoiSearch")||window.componentManager.get("SearchInView");if(!n)return null;var t=n.modelQuery,r=location.pathname,o=map.getBounds(),i="&l="+map.getZoom(),u="";if(document.location.href.indexOf("format=1")>-1&&(u="&format=1"),t.indexOf("&l=")>-1&&(i=""),t=t.replace(/%3C/gi,encodeURIComponent(" ")).replace(/%3E/gi,encodeURIComponent(" "))+"&tn="+map.mapType,t.indexOf("&nn=")<0&&(t+="&nn=0"),t.indexOf("b=(")>-1)t=r+a.DATA_URL+t+u+"&ie=utf-8"+i+"&t="+(new Date).getTime();else{var c=Math.min(o.minX,o.maxX),s=Math.max(o.minX,o.maxX),l=Math.min(o.minY,o.maxY),p=Math.max(o.minY,o.maxY);t=r+a.DATA_URL+t+u+"&ie=utf-8"+i+"&b=("+c+","+l+";"+s+","+p+")&t="+(new Date).getTime()}var f=null;if(e){var d=null;for(var h in e)d=h+"="+e[h],t.indexOf(h+"=")>-1?(f=new RegExp(h+"=[^&]+","g"),t=t.replace(f,d)):t+="&"+d}var m=new T.Deferred;return T.ajax(t,{dataType:"json",success:function(e){return e&&e.result?(!e.content||2!=e.content[0].poiType&&4!=e.content[0].poiType||(e.busLineUid=e.content[0].uid),void m.resolve(e,t)):void m.resolve(null)},error:function(){m.resolve(null)}}),m},getCurrentCityByArea:function(e,n,t,r,o){var a=(new Date).getTime(),i=e+","+n+";"+t+","+r;baidu.ajax("/?newmap=1&qt=ncent&ie=utf-8&b="+i+"&l=16&t="+a,{dataType:"json",success:function(e){if(e&&e.content&&e.current_city){return void o(e)}},error:function(){}})},hasRouteVideo:function(){function e(){T.jsonp(t,function(e){if(e)for(var t=0,r=e.length;r>t;t++)if(o==e[t].cityCode)return void n.resolve(!0);n.resolve(!1)})}var n=new T.Deferred,t="/?newmap=1&qt=panoRouteVideo",r=window.currentComponent,o=a.cityCode;return r&&"NavTrans"==r.name?r.tpList.length>0?n.resolve(!1):r.sCity.code==r.eCity.code?e():this.getUpCity(r.sCity.cname,r.eCity.cname).then(function(t,r){t.upCityCode==r.upCityCode?e():n.resolve(!1)}):n.resolve(!1),n},getUpCity:function(){function e(e){var n=new T.Deferred,t="newmap=1&wd="+encodeURI(e);return baidu.ajax("/?qt=s",{method:"get",dataType:"json",data:t,success:function(e){var t=e?e.current_city:null;n.resolve(t)}}),n}for(var n=new T.Deferred,t=Array.prototype.slice,r=[],o=t.call(arguments),a=[],i=0,u=o.length;u>i;i++)a.push(e(o[i]));var c=T.when.apply(null,a);return c.then(function(){for(var e=t.call(arguments),o=0,a=e.length;a>o;o++){var i=e[o];r.push({upCityCode:i.up_cityid?i.up_cityid:i.code})}n.resolve.apply(null,r)}),n},getRouteVideoParamFromPCMap:function(e){var n=new T.Deferred;if("NavTrans"==currentComponent.name){for(var t=r.urlConfig.PANO_ROUTE_VIDEO_URL,o=r.urlConfig.PANO_VIDEO_SERVER_URL,a=r.urlConfig.PANO_3DIMAGE_URL,i=null,u=0,s=e.length;s>u;u++)if(e[u].src){i=e[u];break}var l=i?i.src.replace("?qt=pr3d","?qt=share").replace("&width=196&height=100",""):"",p=currentComponent.getPanoNavParams(),f={currentCity:p.currentCity,sc:p.sc,ec:p.ec,strategy:p.strategy,drag:-1,day:p.day,bound:p.bound,t:(new Date).getTime(),time_index:p.time_index,extinfo:p.extinfo,start:encodeURI(p.start),end:encodeURI(p.end),level:p.level,et:-1,st:-1,udt:"201400616",qt:"routeVideo",id:0};c.each(window.currentComponent.navListViews||[],function(e,n){return e.isActive===!0?(f.id=n,!0):void 0});var d=window.componentManager.getLastSearchTime("nav"),h=document.cookie.match(/BAIDUID=([^;]*)/);h=h[1]?h[1].replace(/[\W]/g,"_"):"",f.key=h+"_"+d;var m=new T.Deferred;if(f.sc!=f.ec){var v=currentComponent;this.getUpCity(v.sCity.cname,v.eCity.cname).then(function(e,n){f.sc=e.upCityCode,f.ec=n.upCityCode,m.resolve()})}else m.resolve();return m.then(function(){var e={imageUrl:l,videoParam:t+"/?"+T.url.jsonToQuery(f),playerUrl:"/wolfman/static/pano/swf/pano_whole/StreetscapePlayer_7556add.swf",offsetLeft:314,errorImageUrl:"http://webmap0.map.bdstatic.com/wolfman/static/pano/images/pano_whole/img_error_8d3eb72.png",videoServerUrl:o+"/?qt=video",imageServerUrl:a+"?newmap=1&qt=pr3d"};n.resolve(e)}),n}},copy:function(e,n){var t=typeof e;if(t=t.toLowerCase(),T.isArray(e))return c.each(e,function(e){return c.copy(e,n)},!0);if(T.isObject(e)){var r,o={};for(var a in e)r=n?a.toLowerCase():a,o[r]=c.copy(e[a],n);return o}return e},bind:function(e,n){return function(){e.apply(n,arguments)}},clearTag:function(e){return e?e.replace(u,""):""},parse2Geo:function(e){return o.parse2Geo(e)},getPointFromGeoStr:function(e){var n=e.split("|");if("1"!==n[0])return null;var t=n[2].split(";")[0];return t=t.split(","),new BMap.Point(t[0],t[1])},getAngleFromP2P:function(e,n){var t=e,r=180*Math.atan(Math.abs((n.x-t.x)/(n.y-t.y)))/Math.PI;return n.x>=t.x&&n.y<=t.y&&(r=180-r),n.x<=t.x&&n.y<=t.y&&(r=180+r),n.x<=t.x&&n.y>=t.y&&(r=360-r),r},getDomSize:function(e){var n=e.parentNode,t=e.nextSibling,r=document.createElement("div");r.style.cssText="position:absolute;top:-9999px;left:-9999px",n.removeChild(e),r.appendChild(e),document.body.appendChild(r);var o=e.offsetWidth,a=e.offsetHeight;return r.removeChild(e),n.insertBefore(e,t),document.body.removeChild(r),{width:o,height:a}},parseUrlParam:function(e){if(e.indexOf("?")>-1)var n=e.slice(e.indexOf("?")+1);else{if(!(e.indexOf("#")>-1))return;var n=e.slice(e.indexOf("#")+1)}if(""!=n){for(var t={},r=n.split("&"),o=0;o<r.length;o++){var a=r[o].split("=");if(a[1]){var i=a[1].indexOf("#");a[1]=i>-1?a[1].slice(0,i):a[1],t[a[0]]=a[1]}}return t}},monitorReport:function(e,n,t,r,o,a){function i(e,n){var t="",r="";return e?n>2e3?(t="slow",r=3e3>n?"req_slow2":6e3>n?"req_slow3":"req_slow6"):(t="succ",r="succ"):(t="fail",r="con_fail"),{subtype:t,subvalue:r}}function u(e){var n=[];for(var t in e)n.push(t+"="+e[t]);n=n.join("&");var r="http://log.map.baidu.com/tn.gif?"+n,o=new Image;o.src=r}var c=i(n,t);"succ"==c.subtype&&(o=.01*o),Math.random()<o&&u({product:"Pano",module:"Pano_"+e,subtype:c.subtype,subvalue:c.subvalue,value:t,detail:encodeURIComponent(r),logid:a,represent:o>1?1:o,time:Math.floor(.001*(new Date).getTime())})},startClock:function(e,n){var t=this;window._pano_timer||(window._pano_timer={});var r=window._pano_timer;window.onbeforeunload=function(){t.stopClock(e)},r[e]||(r[e]={name:e,state:1,start:(new Date).getTime(),fn:n})},stopClock:function(e){var n=window._pano_timer;if(n&&n[e]){var t=n[e],r=t.fn;r&&r.call(t,Math.round(((new Date).getTime()-t.start)/1e3)),delete n[e]}},revertStreetView:function(e){var n="",t="";return e.pid?(t=e.pid,n=e.iid||""):"inter"===e.panotype?n=e.panoid:t=e.panoid,"alamap"===e.from&&addStat(STAT_CODE.STAT_PANORAMA,{item:e.panotype,catalog:"alamap",func:"alamap",query:e.pword}),{panoId:t,panoIId:n,panoType:e.panotype,panoHeading:e.heading,panoPitch:e.pitch,panoZoom:e.l,panoShareParam:e.psp,from:"share"}},getUgcUploadUrl:function(){return"http://pai.baidu.com/?from=pcmap"},isSupportVideo:function(){var e=navigator.appVersion;if(-1!==e.indexOf("MSIE 9.0")||baidu.ie<11)return!1;try{var n=document.createElement("video");return n&&n.canPlayType?!0:!1}catch(t){return!1}}};!function(e){var n=document.body.filters;n&&(e.isIE=function(){return!0},e.setOpacity=function(e,n){e.style.filter="alpha(opacity="+parseInt(100*n)+")"})}(c),function(){var e=history.replaceState,n=navigator.userAgent.toLowerCase(),t=n.indexOf("lbbrowser")>-1;c.isSupportChangeStatus=!e||t?function(){return!1}:function(){return!0}}(c),function(e){var n=null,t=null,r=0,o=[],a=!1;e.isHashChangeListing=function(){return null!==n},e.setHash=function(e){var n=e.match(/pid=([\w\d]*)/),t=location.hash.match(/pid=([\w\d]*)/);a=!0,location.hash=e,n&&t&&n[1]===t[1]||o.push(e)},e.clearHash=function(){location.hash="",a=!1,o=[]},e.onHashChange=function(e){if(n)e&&n.push(e);else{var r=n=[];e&&r.push(e),t=function(){if(a===!0)return void(a=!1);if(o.length>=1){o.pop();var e=o[o.length-1]||"";location.hash!==e&&(a=!0,location.hash=e);for(var n=0;n<r.length;n++)r[n].call(null,e)}},"addEventListener"in document.body?window.addEventListener("hashchange",t):window.attachEvent("onhashchange",t)}},e.offHashChange=function(){n=null,"removeEventListener"in document.body?window.removeEventListener("hashchange",t):window.detachEvent("onhashchange",t),t=null,r&&clearTimeout(r)}}(c),c.createTask=function(){var e=function(e){this._opts=c.merge({timeout:5e3},e),this._queue=[]};return e.prototype={add:function(e,n){return this._queue.push({fn:e,timeout:void 0===n?this._opts.timeout:n}),this},start:function(){for(var e,n,t=this._queue,r=0,o=t.length;o>r;r++)if(n=t[r],0===r){var a=n.fn.call(null);a&&"function"==typeof a.state&&"resolved"!==a.state(),e=baidu.when(a)}else e=e.then(function(e){return function(){var n=e.fn.call(null);return n&&"function"==typeof n.state&&"resolved"!==n.state(),n}}(n,r));return e}},e.prototype.constructor=e,function(n){return new e(n)}}(),t.exports=c});
;define("pano:widget/base/service.js",function(t,e,n){function a(t,e,n,a){if(e){var r=arguments.length;3==r&&(a=n,n=null);var o=new T.Deferred;e.t=(new Date).getTime();var i=[];for(var u in e)void 0!==e[u]&&i.push(u+"="+e[u]);i=i.join("&");var c=t+i,l=function(t){n&&n(t),o.resolve(t)};return baidu.jsonp(c,l,{cbtype:a?a:"fn"}),o}}var r=t("common:widget/ui/config/config.js"),o=t("pano:widget/base/util.js"),i=t("pano:widget/base/CatalogMap.js"),u=r.mapVersion,c=r.urlConfig,l=function(){var t=null,e=function(t){var e=t.getFullYear(),n=t.getMonth()+1,a=t.getDate();return n=10>n?"0"+n:n,a=10>a?"0"+a:a,[e,n,a].join("-")};return function(){if(!t){t={};var n=new Date,a=new Date;a.setDate(n.getDate()+2);var r=new Date;r.setDate(n.getDate()+3),t.start=e(a),t.end=e(r)}return t}}(),s={poiDetail:{}},f=u.UDT_VERSION||"20140317",p=c.PANO_URL+"?udt="+f+"&",d=c.PANO_URL+"?qt=guide&",v="/?",g=c.PANO_PHPUI_URL+"/?",h="/detail?",y=c.PANO_URL+"?qt=search&",D={getPanoInfoByUid:function(t,e){var n=a(p,{qt:"poi",uid:t});return e?n.then(function(t){e(t)}):n},getPanoPoiInfoByUid:function(t,e){var n=new T.Deferred;return a(v,{qt:"inf",uid:t},"callback").then(function(t){e&&e(t),n.resolve(t)}),n},getHotelInfoByUid:function(t,e){var n=l(),r=a(h,{qt:"ota",st:n.start,et:n.end,uid:t},"callback");return e?r.then(function(t){e(t)}):r},getMovieInfoByUid:function(t,e){var n=a(h,{qt:"timetable",uid:t,from:"pc",sfrom:"map",sflag:"bubble"},"callback");return e?n.then(function(t){e(t)}):n},getIndoorPoiInfoByUid:function(t){if(s.poiDetail[t]){var e=s.poiDetail[t];return(new T.Deferred).resolve().then(function(){return e})}return(new T.Deferred).resolve().then(function(){return s.businessList?s.businessList:a(v,{qt:"panoCMS",file:"inter_commercial"},null,"callback").then(function(t){return s.businessList=t,s.businessList})}).then(function(e){var n=new T.Deferred,r=0,o=function(){a(g,{qt:"poidetail",uid:t,t:(new Date).getTime()}).then(function(a){r++,0==a.result.error_type||200==a.result.error_type?(a.content.businessData=e[t],s.poiDetail[t]=a,n.resolve(a)):2>r?o():n.resolve(a)})};return o(),n})},getGuideData:function(t,e){function n(t){var e=[],n=[],a=[],r=null,o=!1,u=0,c=t.length;for(u=0,c=t.length;c>u;u++)if(t[u].Catalog){o=!0,r={exit:[],other:[]};break}for(var u=0,c=t.length;c>u;u++){var l=t[u];if(7!=l.Type){var s={photoUrl:null,name:l.Info,type:l.Type,catalog:l.Catalog,data:{prvFovy:l.PrvFovy||35,prvHeading:l.PrvDir||l.Dir,prvPitch:l.PrvPitch||0==l.prvPitch?l.PrvPitch:l.pitch,tourId:l.TourID,floor:l.Floor,panoId:l.PID,panoHeading:l.Dir,panoPitch:l.Pitch,type:l.Type,panoX:l.PanoX,panoY:l.PanoY,x:l.X,y:l.Y,uid:l.UID,rank:l.Height}};if(o)if(3===s.type)r.exit.push(s);else{var f=i.getCatalogInfo(s.catalog);r[f.id]||(r[f.id]=[]),r[f.id].push(s)}0===l.Type?n.push(s):8===l.Type?a.push(s):e.push(s)}}return{panoAllumData:e,topicData:a,panoTimelineData:n,catalogData:r}}var a=d+"sid="+t;baidu.jsonp(a,function(t){var a={},r=!0;t&&0==t.result.error&&t.content&&(a=n(t.content),r=!1),e({content:a.panoAllumData,topicData:a.topicData,panoTimelineData:a.panoTimelineData,catalogData:a.catalogData,error:r})},{cbtype:"fn"})},checkBounds:function(t,e,n){if("function"==typeof e){n=n||window;var a=p+baidu.url.jsonToQuery({qt:"qmdata",bx:t.getMinX(),by:t.getMinY(),tx:t.getMaxX(),ty:t.getMaxY(),t:(new Date).getTime()});baidu.jsonp(a,function(t){if(t&&0==t.result.error&&t.content){var a=t.content.ptcnt||0;e.call(n,{content:{ptcnt:a},error:0})}else e.call(n,{error:1})},{cbtype:"fn"})}},getStreetBriefByLocation:function(t,e){if(t.point&&"function"==typeof e){var n=t.point||{},a=t.level||15,r=t.mode||"day",o=p+baidu.url.jsonToQuery({qt:"qsdata",x:n.lng||n.x,y:n.lat||n.y,l:a,action:0,mode:r,t:(new Date).getTime()});baidu.jsonp(o,function(t){if(t&&t.result&&0==t.result.error&&t.content){var n=t.content,a=n.id,r=parseFloat(n.x/100),o=parseFloat(n.y/100),i=new BMap.Point(r,o),u=p+baidu.url.jsonToQuery({qt:"pdata",sid:a,pos:"0_0",z:"0"});e({type:"brief",content:{id:a,point:i,rname:n.RoadName||"",panoImg:u},error:0})}else e({error:1})},{cbtype:"fn"})}},getNavSearch:function(t){return a(v,t,null,"callback")},getNavSteps:function(t){return a(g+"qt=routeSteps&",t,null,"callback").then(function(t){var e=t.content.traffic_steps,n=o.each(t.content.steps,function(t,n){var a={rx:t.RX/100,ry:t.RY/100,x:t.X/100,y:t.Y/100,dir:t.dir,pid:t.pid},r=e[n];r||(r={end:[1],status:1}),a.instructions=o.clearTag(t.instructions);var i=0,u=o.each(r.end,function(t,e){var n=Math.ceil(100*t);return i+n>100&&(n=100-i),i+=n,{value:n,status:r.status[e]}},!0);return 100>i&&(u[u.length-1].value+=100-i),a.traffic=u,a},!0);return n[0].pid||(n=n.slice(1)),t.content.steps=n,delete t.content.traffic_steps,t})},getClassifySearchData:function(t,e,n,r){function i(t,e){if(!t||0===t.content.length)return null;var n=t.content;return o.each(n,function(t){return{poiuid:t.UID,pid:t.PID,panoIId:t.IID,poiType:"poi",catalog:e,name:t.name,rank:t.Height,heading:t.Dir,pitch:t.Pitch,x:t.X,y:t.Y,px:t.PanoX,py:t.PanoY,index:-1}},!0)}var u={0:"",1:"FE02",2:"FE01",3:"FE06",4:"FE0A",5:"FEFE"},c=a(y,{x:t,y:e,radius:200,tag:n},"fn");return r?c.then(function(t){t=i(t,u[n]),r(t)}):c},getComponentResultByQuery:function(t){var e="/?qt="+t,n=new T.Deferred;return T.ajax(e,{dataType:"json",success:function(t){return t&&t.result?void n.resolve(t,e):void n.resolve(null)},error:function(){n.resolve(null)}}),n},getPanoPoints:function(t,e){var n=t.join("|");e=e||"bus";var a="udt="+f+"&qt=batchdata&from="+e+"&key="+n,r=new T.Deferred;return baidu.ajax("/?qt=panobatch",{method:"post",dataType:"json",data:a,success:function(t){r.resolve(t)}}),r},getBuslineByUid:function(t,e){var n=a(v,{qt:"bsl",bsltp:"1",newmap:"1",uid:t,c:e,t:(new Date).getTime()},null,"callback"),r=this;return n.then(function(t){var e=t.content[0].stations,n=t.content[0].name,a=[],i="",u=null,c="";0==t.result.linetype||6==t.result.linetype?c="010A05":1==t.result.linetype&&(c="010A03");for(var l=0,s=e.length;s>l;l++)i=e[l].geo,i=i.split("|")[2].split(";")[0],a.push(i),u=i.split(","),e[l].point={x:u[0],y:u[1]};return r.getPanoPoints(a,"busline").then(function(t){return o.each(a,function(n,a){t.content[a]&&(e[a].pano=t.content[a])}),{buslineName:n,stations:e,catalog:c}})})},getPanoCityPageData:function(t){return a(v,{qt:"panoReco",code:t,t:(new Date).getTime()},null,"callback")},getSdataByPid:function(){var t={};return function(e){var n=new T.Deferred;return t[e]?n.resolve(t[e]):a(p,{qt:"sdata",pc:1,sid:e},null,"fn").then(function(a){a&&a.result||n.resolve(null);var r=a.content[0]||a.content,i=o.copy(r,!0);t[e]=i,n.resolve(i)}),n}}(),getIndoorData:function(t){var e=new T.Deferred;return a(p,{qt:"idata",iid:t},null,"fn").then(function(t){if(!t||!t.result)return null;var n=(t.content[0]||t.content).interinfo,a=o.copy(n,!0);e.resolve(a)}),e},getActiveData:function(){return a(v,{qt:"panoCMS",file:"mobileopsupport"},null,"callback").then(function(t){var e=t.activity||[];return o.each(e,function(t){t.center&&(t.center=T.json.parse(t.center)),t.range&&(t.range=T.json.parse(t.range)),t.pids&&(t.pids=T.json.parse(t.pids))}),e})},getCopyRightData:function(){return a(v,{qt:"panoCMS",file:"pano_copyright"},null,"callback")},getCursorPic:function(){return a(v,{qt:"panoCMS",file:"streetviewtoolsview"},null,"callback")}};n.exports=D});
;define("pano:widget/PanoInterface/PanoInterface.js",function(n,e,t){var a,o,i=n("pano:widget/Transition/Transition.js"),r=!1,c=function(){var n=!1,e=0,t=null;if(window.ActiveXObject){if(t=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")){n=!0;var a=t.GetVariable("$version");e=a.match(/[\d\.]+/)}}else navigator.plugins&&navigator.plugins.length>0&&(t=navigator.plugins["Shockwave Flash"],t&&(n=!0,e=t.description.match(/[\d\.]+/)));return e=1*e[0],c=n?function(){return e}:function(){return!1},n?e:!1},u=function(){var n,e=document.createElement("canvas"),t=!0;try{n=e.getContext("experimental-webgl")||e.getContext("webgl")||e.getContext("moz-webgl")||e.getContext("webkit-3d")}catch(a){}return n||(t=!1),e=null,n=null,t};u()?addStat(STAT_CODE.STAT_PANORAMA,{item:"pano_render_webgl"}):addStat(STAT_CODE.STAT_PANORAMA,{item:"pano_render_flash"}),t.exports={showPano:function(){if(!(a&&a.isRunning()>0)){if(!u()){var e=c();if(!e||10>=e)return void alert("您的电脑尚未安装 Flash 或版本过低，请升级！")}var t={},d=arguments,l=d[0];r!==!0&&(r=!0,i.checkSupport(l.from),function(){var e=new T.Deferred;return a?e.resolve():n.async(["pano:widget/base/service.js","pano:widget/Root.js"],function(n,t){a=t,o=n,e.resolve()}),e}().then(function(){return l.research===!0?o.getPanoInfoByUid(l.searchParam.uid):l.panoIId?o.getIndoorData(l.panoIId):l.panoId?o.getSdataByPid(l.panoId):t}).then(function(n){return n!==t&&n?n.content?(n=n.content[0].poiinfo,{x:n.X,y:n.Y,dir:n.Dir}):n.x&&n.y?{x:n.x/100,y:n.y/100,dir:n.heading}:n.iid?{x:n.ipoint.x/100,y:n.ipoint.y/100,dir:0}:t:t}).then(function(n){var e=n.x,o=n.y,c=n.dir;if(r=!1,n===t||!e||!o)return void a.showPano.apply(a,d);var u=new BMap.Point(e,o),l=c||0;i.enter(null,null,u,l,function(){a.showPano.apply(a,d)})}))}},closePano:function(){a&&a.closePano.apply(a,arguments)}}});
;define("pano:widget/Transition/Util.js",function(){var t=navigator.userAgent.toLowerCase(),e={mapPosToScreenPos:function(t,e){var r=(document.body.clientWidth,document.body.clientHeight,T("#MapHolder").offset()),n={x:t+r.left,y:e+r.top};return n},screenPosToMapPos:function(t,e){var r=(document.body.clientWidth,document.body.clientHeight,T("#MapHolder").offset()),n={x:t-r.left,y:e-r.top};return n},easeIn:function(t){return Math.pow(t,2)},easeOut:function(t){return Math.pow(t,.5)},easeFrom:function(t){return Math.pow(t,4)},easeTo:function(t){return Math.pow(t,.25)},returnTrue:function(){return!0},returnFalse:function(){return!1},isSupportCanvas:function(){var t=!1;try{var e=document.createElement("canvas"),r=e.getContext("2d");t=r&&r.drawImage?!0:!1}catch(n){t=!1}return this.isSupportCanvas=t?this.returnTrue:this.returnFalse,t},isSupportTransform3d:function(){var t=!1;try{var e=document,r=e.body,n=e.createElement("div");n.className="test_css3d";var o=e.createElement("style");o.innerHTML="@media (transform-3d),(transform-3d),(-webkit-transform-3d),(-ms-transform),(-moz-transform){.test_css3d{position:absolute;height:3px;width:3px}}",r.appendChild(o),r.appendChild(n),t=3===n.clientHeight?!0:!1;var i=function(){var t=document.createElement("div"),e="Khtml Ms O Moz".split(" "),r=e.length;return function(n){if(n in t.style)return!0;for(n=n.replace(/^[a-z]/,function(t){return t.toUpperCase()});r--;)if(e[r]+n in t.style&&window.addEventListener)return!0;return!1}}();i("transform")&&(t=!0),r.removeChild(o),r.removeChild(n)}catch(s){t=!1}return this.isSupportTransform3d=t?this.returnTrue:this.returnFalse,t},isSougouBrowser:function(){var e=t.indexOf("se 2.x")>-1?!0:!1;return this.isSougouBrowser=e?this.returnTrue:this.returnFalse,e},isSafariBrowser:function(){var e=t.indexOf("macintosh")>-1?!0:!1,r=t.indexOf("chrome")>-1?!0:!1,n=e&&!r;return this.isMacSafariBrowser=n?this.returnTrue:this.returnFalse,n}};return e});
;define("pano:widget/Transition/Transition.js",function(n){var o=n("pano:widget/Transition/Util.js"),t=null,i=null,a=!0,e=!1,r=!1,s={checkSupport:function(n){a=o.isSupportCanvas()&&o.isSupportTransform3d()&&"share"!==n?!0:!1},enter:function(i,u,l,c,f){a?(this.onPlayStart=f,n.async(["pano:widget/Transition/MapLayer/EnterLayer.js"],function(n){var f=void 0;if(l){l instanceof BMap.Point||!l.lat||!l.lng||(l=new BMap.Point(l.lng,l.lat));var p=window.map.pointToPixel(l);f=o.mapPosToScreenPos(p.x,p.y)}t=new n(i,l,u,f,c,function(n){n===!0&&(a=!1),s.onPlayStart()},function(){r=!0,e&&s.close(),s.onPlayEnd()})})):f()},exit:function(t,e,r,u,l){return a?void n.async(["pano:widget/Transition/MapLayer/ExitLayer.js"],function(n){var a=window.map,c=o.mapPosToScreenPos(a.width/2,a.height/2);i=new n(t,r,e,c,u,function(){s.close()}),l()}):void l()},onShow:function(n){a?this.onPlayEnd=n:n()},close:function(){a&&(t&&(t.fadeOut(),t=null,r=!1),i&&(i.fadeOut(),i=null))},enableAutoutoClose:function(){e=!0,r===!0&&this.close()},onPlayStart:function(){},onPlayEnd:function(){}};return s});
;define("pano:widget/PanoEntranceUtil/PanoEntranceUtil.js",function(t,e,a){var n=t("common:widget/ui/util/util.js"),i=t("common:widget/ui/config/config.js"),o=t("common:widget/ui/indexUtil/IndexUtil.js"),r=t("pano:widget/PanoInterface/PanoInterface.js"),d=(t("pano:widget/base/service.js"),i.urlConfig),s=i.mapVersion,p=window.Pano=window.Pano||{},u={insertPanoInfoInSearch:function(t,e,a){if(!o.isSupportStreetView())return a(null),void this.dispatchEvent("onSearchPanoDataReady",{data:null});for(var n=[],r=0,p=t.length;p>r;r++)n.push(t[r].uid||t[r].mercatorLnglat);var u=this,l="udt="+s.UDT_VERSION+"&qt=batchdata&from="+e+"&key="+n.join("|");baidu.ajax("/?qt=panobatch",{method:"post",dataType:"json",data:l,success:function(e){for(var n=e||{},i=n.content||[],o=[],r=null,p=null,l=!0,h=0,c=i.length;c>h;h++){r=i[h]||{},p=t[h],r.PID&&l&&(l=!1);var m="";if(m=p.name?p.name:r.name,p.mercatorLnglat){var f=p.mercatorLnglat.split(",");r.Dir||(r.Dir=90-180*Math.atan2(f[1]-r.PanoY,f[0]-r.PanoX)/Math.PI),r.Dir<0&&(r.Dir+=360)}else f=[0,0];var g=0;g=p.direction&&0!=h&&h!=c-1?p.direction:r.Dir;var v=d.PANO_URL;v=r.UID?d.PANO_URL+"/pr/?qt=poiprv&uid="+r.UID+"&width=100&height=75&quality=80&fovx=80&udt="+s.UDT_VERSION:d.PANO_URL+"/pr/?qt=prv&panoid="+r.PID+"&width=100&height=75&quality=80&fovx=80&heading="+g+"&udt="+s.UDT_VERSION;var b={panoId:r.PID||"",uid:r.UID||"",panoMarker:{addr:r.name||"",poiuid:r.UID||"",pid:r.PID||"",catalog:p.poiType||"",name:m,rank:r.Rank||0,heading:g,pitch:r.Pitch||0,x:r.X||f[0],y:r.Y||f[1],px:r.PanoX||f[0],py:r.PanoY||f[1],index:p.index||-1},panoThumbnailUrl:v};o.push(b)}l&&(o=null),a(o),u.dispatchEvent("onSearchPanoDataReady",{data:o})},error:function(t){console.log("panopatch",t)}}),addStat(STAT_CODE.STAT_STREETVIEW,{cityCode:i.modelConfig.cityCode,catalog:e,item:"panobatch"})},showStreetViewPreview:function(t,e,a,i){var o=this,r=T(".list_street_view_preview"),d=e.getAttribute("data-thumbnail"),s={buslineUid:e.getAttribute("data-buslineUid"),panoId:e.getAttribute("data-pid"),uid:e.getAttribute("data-uid"),panoMarker:{addr:e.getAttribute("data-paddr"),px:e.getAttribute("data-px"),py:e.getAttribute("data-py"),name:e.getAttribute("data-pname"),heading:e.getAttribute("data-pheading")},hasRouteVideo:i},p=e.getAttribute("data-pfrom");t?this.timeoutId=setTimeout(function(){var e=n.getClientSize().height-t.top<150;r.length?(r.css({left:t.left-1,top:t.top}),r.find("img").attr("src",d),r.off("click"),r.on("click",function(){o.enterPanorama(s,a,"search",p)}),r.show()):(r=T('<div style="left:'+(t.left-1)+"px;top:"+t.top+'px" class="list_street_view_preview"><img src="'+d+'" onerror="Pano.PanoEntranceUtil.thumbnailNotFound(this, 100, 75);" width="100" height="75" /><div class="list_street_view_preview_icon_box"><div class="list_street_view_preview_icon"></div></div></div>'),T("body").append(r),r.on("mouseleave",function(){r.hide()}),r.on("click",function(){o.enterPanorama(s,a,"search",p)})),e?(r.addClass("bottom"),r.css({top:t.top-53})):r.removeClass("bottom")},200):o.enterPanorama(s,a,"routeVideo_button",p)},thumbnailNotFound:function(t){t.src="http://webmap0.map.bdstatic.com/wolfman/static/pano/images/panorama/2d_default_aspect_ratio_3_d58ce0c.png"},walkThroughPanoEntrances:function(t,e,a,n,i){var o,r=this;if(e&&0!=e.length){T(".closeWalkInfo").css({"margin-top":0});for(var d=0;d<t.length;d++)o=e[d],this.setPanoPreviewDomAttribute(t[d],o,a);t.off("mouseleave"),t.off("mouseenter"),t.on("mouseenter",function(){var t=T(this),a=t.offset().left+22;r.showStreetViewPreview({left:a,top:t.offset().top-6},this,n||e,i)}),t.on("mouseleave",function(){clearTimeout(r.timeoutId)})}else for(var d=0;d<t.length;d++)t[d].style.display="none"},setPanoPreviewDomAttribute:function(t,e,a){e.panoId?(t.style.visibility="visible",t.setAttribute("data-thumbnail",e.panoThumbnailUrl),t.setAttribute("data-pid",e.panoId),t.setAttribute("data-pname",e.panoMarker.name),t.setAttribute("data-px",e.panoMarker.px),t.setAttribute("data-py",e.panoMarker.py),t.setAttribute("data-paddr",e.panoMarker.addr),t.setAttribute("data-pheading",e.panoMarker.heading),t.setAttribute("data-pfrom",a)):t.style.visibility="hidden"},addPanoEntranceInInfoWindow:function(t,e,a){var n=this;n.insertPanoInfoInSearch([{mercatorLnglat:e.lng+","+e.lat}],"",function(e){if(e&&e.length>0){var i=n.addPanoThumbnailsInInfoWnd([t],[e[0]],e,"contextMenu",!0);a(i)}else a([t])})},addPanoThumbnailsInInfoWnd:function(t,e,a,n){var i,o,r=null,d=this;switch(n){case"contextMenu":case"busline":thumbnailProperty={size:{width:323,height:101},position:"top",fovx:250,margin:"10px 10px 0 10px"};break;case"bus":case"buswalk":case"nav":case"walk":case"bike":thumbnailProperty={size:{width:240,height:75},position:"middle",elemIndexArr:[0,-1],fovx:250,margin:"6px 0"};break;case"routeaddr":thumbnailProperty={size:{width:258,height:81},position:"middle",elemIndexArr:[1],fovx:250,margin:"0 10px 5px 10px"}}for(i=0,o=t.length;o>i;i++)r=t[i],e[i]&&(r.content=this._getPanoThumbnailHtmlInInfoWnd(r.content,e[i],thumbnailProperty),r.addEventListener("open",function(t){return function(){baidu(".panoInfoBox").on("click",function(){d.enterPanorama(e[t],a,"infownd",n)})}}(i)));return t},_getPanoThumbnailHtmlInInfoWnd:function(t,e,a){function n(t,e,a){var n=document.createElement("div"),i=n.cloneNode();n.innerHTML=e,n=n.childNodes[0],i.innerHTML=t;for(var o=null,o=i,r=0,d=a.length,s=0;d>r;r++)s=a[r],0>s&&(s=o.childNodes.length+s),r!=d-1?o=o.childNodes[s]:o.insertBefore(n,o.childNodes[s]);return i.innerHTML}if(!e||!e.panoId||!e.panoMarker)return t;var i=[],o="",r=a.size.height,p=a.size.width,u=a.fovx,l=a.position;i.push("<div class='panoInfoBox' style='height:"+r+"px;width:"+p+"px; margin:"+a.margin+";' title='"+e.panoMarker.name+"外景' title='查看全景' >");var h="";switch(h=e.panoMarker.poiuid?d.PANO_URL+"/pr/?qt=poiprv&uid="+e.panoMarker.poiuid+"&width="+p+"&height="+r+"&quality=80&fovx="+u+"&udt="+s.UDT_VERSION:d.PANO_URL+"/pr/?qt=prv&panoid="+e.panoId+"&width="+p+"&height="+r+"&quality=80&fovx="+u+"&heading="+e.panoMarker.heading+"&udt="+s.UDT_VERSION,i.push("<img class='pano_thumnail_img' width='"+p+"' height='"+r+"' border='0' alt='"+e.name+"外景' src='"+h+"' onerror='Pano.PanoEntranceUtil.thumbnailNotFound(this, "+p+", "+r+");' />"),i.push("<div class='panoInfoBoxTitleBg' style='width:"+p+"px;'></div><a href='javascript:void(0)' class='panoInfoBoxTitleContent' >进入全景&gt;&gt;</a>"),i.push("</div>"),o=i.join(""),l){case"top":t=o+t;break;case"bottom":t+=o;break;case"middle":t=n(t,o,a.elemIndexArr)}return t},enterPanorama:function(t,e,a,n){addStat(STAT_CODE.STAT_STREETVIEW,{from:a,catalog:n});var i={point:new BMap.Point(t.panoMarker.px,t.panoMarker.py),buslineUid:t.buslineUid,uid:t.uid,panoId:t.panoId,panoType:"street",panoHeading:t.panoMarker.heading,from:n,addr:t.panoMarker.addr,name:t.panoMarker.name,markers:[],panoMarkers:[],hasRouteVideo:t.hasRouteVideo};"routeaddr"===n&&(i.research=!0,i.searchParam={uid:t.uid});for(var o=0,d=e.length;d>o;o++)i.markers.push(e[o].panoMarker);d>2&&i.markers[0].pid==i.markers[1].pid&&(i.markers.splice(1,1),d--),d>2&&i.markers[d-1].pid==i.markers[d-2].pid&&i.markers.splice(d-2,1);for(var s={},o=0,d=i.markers.length;d>o;o++)i.markers[o].pid===i.panoId&&s[i.panoId]!==!0&&(s[i.panoId]=!0,i.panoMarkers.push(i.markers[o]),!i.panoMarkers[0].poiuid&&i.uid&&(i.panoMarkers[0].poiuid=i.uid));"routeVideo_button"==a&&(i.playRouteVideo=!0),r.showPano(i)}};u=baidu.lang.createSingle(u),p.PanoEntranceUtil=u,a.exports=u});