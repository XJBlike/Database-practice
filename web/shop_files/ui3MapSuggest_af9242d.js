define("common:widget/ui/ui3MapSuggest/ui3MapSuggest.js",function(t,e,i){var a,s=function(e){function i(t){return(t||"").replace(/</g,"&lt;").replace(/>/g,"&gt;")}try{var s=t("common:widget/ui/config/config.js"),o=s.modelConfig,n=(s.mapConfig,t("common:widget/ui/util/util.js")),r=t("common:widget/route/setMyPlace/ui3SetMyPlace.js"),u=t("common:widget/ui/searchHistory/hisMgr.js"),d=t("common:widget/ui/toast/toast.js"),c=t("common:widget/ui/userMgr/userMgr.js"),l={input:null,url:"/su",cityId:o.cityCode,type:0,from:null,adjustTop:0,adjustLeft:0,adjustWidth:0,"z-index":1e3,top:0,left:0,width:0,isAutoWidth:!1,onSelect:null,onClose:null,onlyPrecise:!1,showMyPlace:!1,hasHistory:!0};e=T.extend(l,e);var g=e.input;if(!g)return;"$DOM"!==T.type(g)&&(g=e.input=T(e.input));var p,h,m,f="ui3-suggest-item-hover",w=T(document.body),y=!0,v={16:1,17:1,18:1,27:1,91:1,38:1,40:1,13:1},b=h={work:function(){h.isInSuggestList=!1,this.bindInputEvents()},bindInputEvents:function(){g.bind("keyup",this.processKeyUp).bind("keydown",this.processKeyDown).bind("focus",this.processFocus).bind("click",this.processClick).bind("blur",this.processBlur).bind("copy",this.processCopy).bind("paste",this.processPaste)},processFocus:function(){this.onBlur=!1},processBlur:function(){h.isInSuggestList||(this.onBlur=!0,setTimeout(function(){h.hide()},100))},processClick:function(){!e.hasHistory||""!==T.trim(g.val())||h.onEnter||h.onBlur||setTimeout(function(){h.processData(),"search"==e.from?addStat("search.history.sug","show",{da_e_name:"pcmap3"}):"route"==e.from?addStat("route.history.sug","show",{da_e_name:"pcmap3"}):"infowindow"===e.from&&addStat("infowindow.history.sug","show",{da_e_name:"pcmap3"}),addStat("total.history.sug","show",{da_e_name:"pcmap3"})},200)},processKeyDown:function(t){function i(t){var e=t?!1:{extra:l.attr("data-extra")};g.data("sugData",e)}h.onPaste=!1,h.onCopy=!1,h.onEnter=!1,h.onBlur=!1;var a=t.keyCode;if(13!==a&&g.data("sugData",!1),!(a in v&&p))return 13!=a||p||(h.onEnter=!0),void(9==a&&(h.onBlur=!0));27===a&&h.hide();var s;p&&(s=p.find("."+f));var o;s&&!s.length?o=0:s&&(o=s.prevAll().length+1);var n,c=h.userKey;p&&(n=p.find("li"));var l,m;if(38===a&&(0===o?(l=n.eq(-1).addClass(f),g.val(l.attr("data-key"))):(s.removeClass(f),1===o?(g.val(c),m=!0):(l=n.eq(o-2).addClass(f),g.val(l.attr("data-key")))),i(m)),40===a){var w=0;void 0!==h.list?w=h.list.length:void 0!==h.hisList&&null!==h.hisList&&(w=h.hisList.length),0===o?(l=n.eq(0).addClass(f),g.val(l.attr("data-key"))):(s.removeClass(f),o===n.length?(g.val(c),m=!0):(l=n.eq(o).addClass(f),g.val(l.attr("data-key")))),i(m)}if(13==a){if(h.hide(),0===o)return void(h.onEnter=!0);var y=s.attr("data-target");if(y)r.select(y,g);else{var b=s.attr("data-key"),S=s.attr("data-location"),x=s.attr("data-extra")||"";if(g.val(b),"clear"===x)return u.clearSearchData(),void d.show("删除成功");e.onSelect&&e.onSelect.call(this,b,S,x)}}t.preventDefault()},processInput:function(){},processPaste:function(){h.onPaste=!0},processCopy:function(){h.onCopy=!0},processKeyUp:function(t){if(!h.onPaste&&!h.onCopy){var i=t.keyCode;if(!(i in v)){var a=g.val();if(a!==h.userKey){if(""===a&&h.wrap){if(h.hide(),!e.hasHistory)return;h.processData(),addStat("search.history.sug","show",{da_e_name:"pcmap3"})}h.userKey=a,h.sendRequest({url:e.url,cityId:e.cityId,query:a,type:e.type})}}}},sendRequest:function(t){if(""!==t.query){t=T.extend({url:"",query:"",cityId:"",type:""},t);var i=n.formatBounds();0==h.readyState?clearTimeout(h.timeout):1==h.readyState&&h.xhr.abort(),h.readyState=0,h.timeout=setTimeout(function(){h.readyState=1,h.xhr=T.ajax(t.url,{dataType:"json",data:{wd:t.query,cid:t.cityId||e.cityId,type:t.type,newmap:1,b:i,t:+new Date,pc_ver:2},success:function(e){h.readyState=2,h.data=e,e&&h.processData(t.query,"search")}})},200)}},processData:function(t){var i=this;if(t){if(""===T.trim(g.val())||h.onEnter||h.onBlur)return;var a=this.data,s=a.s;if(!s||!s.length)return void this.hide();var o=u.getSearchData();o.done(function(e){i.generateHTML({query:t,sug:s,history:e})})}else{var o=u.getSearchData();o.done(function(t){t.length||e.showMyPlace?i.generateHTML({history:t}):i.wrap&&i.wrap.hide()})}},generateHTML:function(t){function i(){var i,a,s=t.history,o=[],n=0;if(t.query){s.length&&e.hasHistory&&T.each(s,function(e,i){i.wd.indexOf(t.query)>=0&&o.length<3&&o.push(i)}),i=h.processList(o,2),0!==o.length&&addStat("search.sug.history.show","show",{da_e_name:"pcmap3"}),n=n+o.length+t.sug.length-10;for(var r=0;n>r;r++)t.sug.pop();a=h.processList(t.sug,0),h.list=t.sug,m="sug",p.find("ul").empty().append(i+a)}else{var a="";m="history",e.showMyPlace&&(a+=h.processMyPlaceList(),n+=2,addStat("indexleftmenu.setMyPlace.show","click",{da_e_name:"pcmap3"})),s.length&&(a+=h.processList(s,2,"only-history")),a&&(h.hisList=s,p.find("ul").empty().append(a),c.defferd.fail(function(){p.find(".clear-login").show()}))}}t.history;if(this.wrap)i();else{if(window.ui3MapSuggestWrap)p=this.wrap=window.ui3MapSuggestWrap.hide().remove();else{var s=['<div class="ui3-suggest-wrap" id="ui3-suggest-wrap">','<div id="ui3-suggest-scroll">',"    <ul>","    </ul>","</div>","</div>"];window.ui3MapSuggestWrap=p=this.wrap=T(s.join(""))}this.setPosAndSize(),i(),p.appendTo(document.body)}this.bindSuggestEvents(),p.suggestInputTarget!==g&&(y=!1,this.setPosAndSize()),p.show(),p.find("li").width(p.width());var o=T("#ui3-suggest-scroll");o.width(p.width());var n=document.documentElement.clientHeight-p.offset().top-50,r=p.find("ul").height();n=Math.min(n,r),o.height(n),a&&a.dispose(),n>10?(a=new baidu.ui.ScrollPanel({container:"ui3-suggest-scroll",overflow:"overflow-y",autoUpdate:!1,margin:[5,5,5,0]}),a.render("ui3-suggest-scroll"),a.update()):p.hide(),addStat("searchbox.sug.show","show",{da_e_name:"pcmap3"}),p.suggestInputTarget=g},bindGEvents:function(){window.hasUi3MapSuggestGEvents||(window.ui3MapSuggestGEvents=function(){ui3MapSuggestWrap.hide(),window.hasUi3MapSuggestGEvents=!1,w.unbind("click",ui3MapSuggestGEvents)},w.bind("click",ui3MapSuggestGEvents),window.hasUi3MapSuggestGEvents=!0)},processList:function(t,i,a){var s=[];if(T.each(t,function(t,a){var o;0==i?(a=a.split("$"),(!e.onlyPrecise||a[5])&&(o=h.processItem("sug",a[3],a[0]+a[1]+a[2],a[5]),s.push(o))):1==i||(2===i?(o=h.processItem("history",a.wd,a.wd2,"","history",a.platform?a.platform:"3"),s.push(o)):3===i&&(a=a.split("-"),o=h.processItem("history",a[0],a[1]),s.push(o)))}),2===i&&"only-history"===a){var o="清空历史记录";("route"===e.from||"infowindow"===e.from)&&(o="删除历史");var n=['<li class="clear-history" data-extra="clear">','<span class="clear-login"><a class="clear-login-link">立即登录</a>可查看更多历史记录</span>','<a class="clear-link">',o,"</a>","</li>"];s.push(n.join(""))}return s.join("")},processMyPlaceList:function(){return r.init(e.onSelect)},processItem:function(t,e,a,s,o,n){o=o?o:"default";var r=['<li class="ui3-suggest-item" data-from="',n,'" data-type="',t,'" data-key="',e,'" data-location="',a,'" data-extra="',s,'">',"    <a>",'        <i class = "',o,'">',i(e),"</i>","        <em>",i(a),"</em>","    </a>","</li>"];return r.join("")},setPosAndSize:function(){var t=this.wrap,i=g.offset(),a={width:+g.css("width").slice(0,-2),height:+g.css("height").slice(0,-2)},s=e.isAutoWidth?0:e.width||a.width+e.adjustWidth;if(t.css({top:e.top||i.top+a.height+e.adjustTop,left:e.left||i.left+e.adjustLeft,zIndex:e["z-index"]||1e3}),e.isAutoWidth)t.css({"min-width":s});else{var s=e.width||a.width+e.adjustWidth;t.css({width:s})}},bindSuggestEvents:function(){this.wrap.find(".clear-login-link").bind("click",function(){addStat("multi.history.login","click",{da_e_name:"pcmap3",da_trd:e.from}),c.login(void 0,void 0,"sug-his")}),this.wrap.find(".clear-link").bind("click",function(){h.hide(),u.clearSearchData(),d.show("删除成功"),addStat("searchbox.history.clear","click",{da_e_name:"pcmap3"})}),this.wrap.find("li").bind("click",function(t){var i=(T(t.target),T(this));if(!i.hasClass("clear-history")){var a=i.attr("data-type"),s=i.attr("data-key"),o=i.attr("data-location"),n=i.attr("data-extra")||"",r=i.attr("data-from")||"web";if(this.getAttribute("data-target"))return void h.hide();var u=p.suggestInputTarget;u.val(s),e.onSelect&&e.onSelect.call(this,s,o,n),"sug"===a?o?addStat("searchbox.sug.GRequest","click",{da_e_name:"pcmap3"}):addStat("searchbox.sug.GrRequest","click",{da_e_name:"pcmap3"}):"history"===a&&(e.from&&"route"==e.from?addStat("route.sug.history.click","click",{da_e_name:"pcmap3",da_trd:r}):"sug"==m?addStat("searchbox.sug.history.click","click",{da_e_name:"pcmap3",da_trd:r}):e.from&&"search"==e.from?addStat("searchbox.history.click","click",{da_e_name:"pcmap3",da_trd:r}):e.from&&"infowindow"==e.from&&addStat("infowindow.history.click","click",{da_e_name:"pcmap3",da_trd:r}),addStat("history.click","click",{da_e_name:"pcmap3"})),h.hide()}}).bind("mouseenter",function(){}).bind("mouseleave",function(){}).bind("mousedown",function(){h.isInSuggestList=!0}).bind("mouseup",function(){h.isInSuggestList=!1,h.hide()}),e.showMyPlace&&r.bindWrapEvents(this.wrap)},hide:function(){window.ui3MapSuggestWrap&&(p=window.ui3MapSuggestWrap,p.hide())}};return b.work(),{hide:b.hide,wrap:p}}catch(S){"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:S.message||S.description,path:"common:widget/ui/ui3MapSuggest/ui3MapSuggest.js",ln:759})}},o='.pc .ui3-suggest-wrap{font-family:Arial,Helvetica,"Microsoft YaHei",sans-serif}#ui3-suggest-scroll{overflow:hidden;width:100%;overflow:hidden}.ui3-suggest-wrap{position:absolute;background-color:#fff;border:1px solid #E4E6E7;display:none}.ui3-suggest-wrap .ui3-suggest-item a{display:block;height:35px;line-height:35px;padding-right:10px;text-decoration:none;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.ui3-suggest-wrap .ui3-suggest-item i{padding-left:35px;font-style:normal;color:#666;position:relative;z-index:1;padding-top:1px}.ui3-suggest-wrap .ui3-suggest-item i.history{background:url(http://webmap1.map.bdstatic.com/wolfman/static/common/images/ui3/tools/suggestion-icon_013979b.png) no-repeat 12px 2px}.ui3-suggest-wrap .ui3-suggest-item i.default{background:url(http://webmap1.map.bdstatic.com/wolfman/static/common/images/ui3/tools/suggestion-icon_013979b.png) no-repeat 12px -12px}.ui3-suggest-wrap .ui3-suggest-item i.home{background:url(http://webmap1.map.bdstatic.com/wolfman/static/common/images/ui3/tools/suggestion-icon_013979b.png) no-repeat 12px -40px}.ui3-suggest-wrap .ui3-suggest-item i.company{background:url(http://webmap1.map.bdstatic.com/wolfman/static/common/images/ui3/tools/suggestion-icon_013979b.png) no-repeat 12px -26px}.ui3-suggest-wrap .ui3-suggest-item em{margin-left:10px;margin-right:20px;font-style:normal;color:#999}.ui3-suggest-wrap .clear-history{border-top:1px solid #F2F5F8;overflow:hidden}.ui3-suggest-wrap .clear-history .clear-link{height:35px;line-height:35px;text-decoration:none;color:#B2B2B2;float:right;padding:0 10px}.ui3-suggest-wrap .clear-history .clear-link:hover{background-color:#EBEBEB}.ui3-suggest-wrap .clear-history .clear-login-link:hover{text-decoration:underline}.ui3-suggest-wrap .clear-history .clear-login{height:35px;line-height:35px;float:left;color:#333;display:none}.ui3-suggest-wrap .clear-history .clear-login-link{text-decoration:none;color:#3385ff;padding:0 5px 0 30px;background:url(http://webmap2.map.bdstatic.com/wolfman/static/common/images/unloginSug_e5196cc.gif) no-repeat 10px 5px;float:left;height:35px}.ui3-suggest-item-hover a,.ui3-suggest-item:hover a{background-color:#EBEBEB}.ui3-suggest-item-hover em,.ui3-suggest-item:hover em{color:#888}.ui3-suggest-wrap strong{color:#999;float:right;margin-right:15px;display:none;position:relative;z-index:2}.ui3-suggest-item-hover strong{display:block}.ui3-suggest-item-hover strong:hover{color:#666}';t.loadCss({content:o,name:"ui3MapSuggest"}),i.exports={initialize:s}});